# Mana - Claude Context

**é¡¹ç›®**: Mana - æ™ºèƒ½è´¦å•åˆ†æå¹³å°
**æŠ€æœ¯æ ˆ**: React Router v7 + Cloudflare
**æœ€åæ›´æ–°**: 2025-01-16
**å½“å‰çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œå¾…è¡¥å……åˆ—è¡¨å’Œåˆ†æé¡µé¢

---

## ğŸš¨ é‡è¦çº¦æŸ - å¿…é¡»éµå®ˆ

**ç¦æ­¢è¡Œä¸º**ï¼š
- âŒ åœ¨æœªç†è§£é—®é¢˜å‰ä¿®æ”¹ä»»ä½•ä»£ç 
- âŒ åœ¨ç”¨æˆ·æœªæ˜ç¡®æŒ‡ç¤ºæ—¶æ‰§è¡Œ git commit
- âŒ åœ¨æœªç¡®è®¤åŸå› å‰æ›´æ”¹é…ç½®æ–‡ä»¶
- âŒ åŒæ—¶æ‰§è¡Œå¤šä¸ªæ“ä½œ

**å¿…é¡»éµå®ˆçš„æµç¨‹**ï¼š
1. é‡åˆ°é—®é¢˜æ—¶ï¼Œå…ˆåªåš**åªè¯»æ“ä½œ**ï¼ˆRead, ls, git log, git diff, git statusï¼‰
2. åˆ†æå¹¶è¯´æ˜é—®é¢˜åŸå› ï¼Œæå‡ºè§£å†³æ–¹æ¡ˆ
3. **ç­‰å¾…ç”¨æˆ·ç¡®è®¤**åå†æ‰§è¡Œä¿®æ”¹
   - ç”¨æˆ·è¾“å…¥ `1` è¡¨ç¤ºåŒæ„ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œ
4. æ¯æ¬¡åªåšä¸€ä¸ªæ“ä½œï¼Œä¸è¦æ‰¹é‡ä¿®æ”¹

---

---

## ğŸ“– é¡¹ç›®æ¦‚è¿°

Mana æ˜¯ä¸€ä¸ªè‡ªåŠ¨åˆ†æè´¦å•çš„ Web åº”ç”¨ï¼Œæ”¯æŒå¯¼å…¥æ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è¡Œå¡è´¦å•ï¼Œè‡ªåŠ¨åˆ†ç±»ç»Ÿè®¡å¹¶æ£€æµ‹å¼‚å¸¸æ”¯å‡ºã€‚

### æ ¸å¿ƒåŠŸèƒ½
- æ”¯æŒå¤šç§è´¦å•æ ¼å¼ï¼ˆæ”¯ä»˜å®ã€å¾®ä¿¡ã€CSVã€Excel .xlsx/.xlsï¼‰
- å®¢æˆ·ç«¯æ™ºèƒ½è§£æå’Œåˆ†ç±»ï¼ˆåŸºäºå…³é”®è¯åŒ¹é…ï¼‰
- å¼‚å¸¸æ£€æµ‹ï¼ˆé«˜é¢æ”¯å‡ºã€é¢„ç®—è¶…æ”¯ï¼‰
- æœåŠ¡ç«¯æ•°æ®å­˜å‚¨ï¼ˆCloudflare D1ï¼‰
- AI æ™ºèƒ½åˆ—è¯†åˆ«ï¼ˆéƒ¨åˆ†å®ç°ï¼Œå®¢æˆ·ç«¯å®Œæˆï¼‰

### æŠ€æœ¯çº¦æŸ
- éƒ¨ç½²å¹³å°: Cloudflare Pages + Workers
- æ•°æ®åº“: Cloudflare D1 (SQLite)
- å­˜å‚¨: Cloudflare R2
- å¿…é¡»æ”¯æŒæœ¬åœ°å¼€å‘

---

## ğŸ›  æŠ€æœ¯æ ˆ

### å‰ç«¯æ¡†æ¶
- **React Router v7** (åŸ Remix) - å…¨æ ˆ React æ¡†æ¶
- **React 19** - UI åº“
- **TypeScript** - ç±»å‹å®‰å…¨
- **Tailwind CSS v4** - æ ·å¼æ¡†æ¶

### åç«¯/éƒ¨ç½²
- **Cloudflare Workers** - Serverless è¿è¡Œæ—¶
- **Cloudflare Pages** - å‰ç«¯æ‰˜ç®¡
- **Cloudflare D1** - SQLite åˆ†å¸ƒå¼æ•°æ®åº“
- **Cloudflare R2** - å¯¹è±¡å­˜å‚¨ï¼ˆè´¦å•æ–‡ä»¶ï¼‰

### å¼€å‘å·¥å…·
- **Vite** - æ„å»ºå·¥å…·
- **Wrangler** - Cloudflare CLI
- **pnpm** - åŒ…ç®¡ç†å™¨
- **TypeScript** - ç±»å‹æ£€æŸ¥

### ä¾èµ–åº“
- **xlsx** - Excel æ–‡ä»¶è§£æ
- **papaparse** - CSV è§£æ

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
mana/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ routes/              # é¡µé¢è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ _index.tsx       # é¦–é¡µï¼ˆä»ªè¡¨ç›˜ï¼‰
â”‚   â”‚   â””â”€â”€ bills.new.tsx    # ä¸Šä¼ è´¦å•é¡µé¢
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ db.ts            # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”‚   â””â”€â”€ schema.sql   # æ•°æ®åº“è¡¨ç»“æ„
â”‚   â”‚   â”œâ”€â”€ client/          # å®¢æˆ·ç«¯è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ api/             # API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ cache/           # ç¼“å­˜ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ parsers/         # è´¦å•è§£æå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ csv.ts       # é€šç”¨ CSV è§£æ
â”‚   â”‚   â”‚   â”œâ”€â”€ alipay.ts    # æ”¯ä»˜å®è´¦å•è§£æ
â”‚   â”‚   â”‚   â”œâ”€â”€ wechat.ts    # å¾®ä¿¡è´¦å•è§£æ
â”‚   â”‚   â”‚   â”œâ”€â”€ smart-parser.ts    # AI æ™ºèƒ½è§£æ
â”‚   â”‚   â”‚   â””â”€â”€ universal.ts       # é€šç”¨è§£æå™¨
â”‚   â”‚   â””â”€â”€ analyzers/       # åˆ†æå™¨
â”‚   â”‚       â”œâ”€â”€ categorizer.ts  # æ™ºèƒ½åˆ†ç±»
â”‚   â”‚       â””â”€â”€ anomaly.ts      # å¼‚å¸¸æ£€æµ‹
â”‚   â”œâ”€â”€ root.tsx             # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ entry.client.tsx     # å®¢æˆ·ç«¯å…¥å£
â”‚   â”œâ”€â”€ entry.server.tsx     # æœåŠ¡ç«¯å…¥å£
â”‚   â””â”€â”€ styles.css           # å…¨å±€æ ·å¼
â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”œâ”€â”€ wrangler.toml            # Cloudflare é…ç½®
â”œâ”€â”€ vite.config.ts           # Vite é…ç½®
â”œâ”€â”€ tsconfig.json            # TypeScript é…ç½®
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md                # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ QUICKSTART.md            # å¿«é€Ÿå¼€å§‹
â”œâ”€â”€ REVIEW.md                # é¡¹ç›®æ€»ç»“å’Œ TODO
â””â”€â”€ CLAUDE.md                # æœ¬æ–‡ä»¶
```

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### React Router v7 ç‰¹æ€§
- **Loaders**: æœåŠ¡ç«¯æ•°æ®åŠ è½½å‡½æ•°
- **Actions**: è¡¨å•æäº¤å’Œæ•°æ®ä¿®æ”¹å‡½æ•°
- **Context**: è®¿é—® Cloudflare ç¯å¢ƒå˜é‡ï¼ˆDBã€BUCKETï¼‰

### æ•°æ®æµ
```
ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
  â†’ Remix Action æ¥æ”¶
  â†’ è°ƒç”¨å¯¹åº”çš„ Parser è§£æ
  â†’ è°ƒç”¨ Categorizer æ™ºèƒ½åˆ†ç±»
  â†’ è°ƒç”¨ DB æ“ä½œä¿å­˜åˆ° D1
  â†’ è°ƒç”¨ Anomaly Detector æ£€æµ‹å¼‚å¸¸
  â†’ é‡å®šå‘åˆ°ç»“æœé¡µé¢
```

### æ•°æ®åº“è®¾è®¡
```sql
bills (è´¦å•è¡¨)
  - id, source, amount, category, description, transaction_date, original_data

categories (åˆ†ç±»è§„åˆ™è¡¨)
  - id, name, keywords (JSON), budget_limit

anomalies (å¼‚å¸¸è®°å½•è¡¨)
  - id, bill_id, reason, detected_at
```

---

## ğŸ“ å¼€å‘è§„èŒƒ

### æ–‡ä»¶å‘½å
- è·¯ç”±æ–‡ä»¶: `app/routes/*.tsx`
- ç»„ä»¶æ–‡ä»¶: `app/components/*.tsx`
- å·¥å…·å‡½æ•°: `app/lib/*.ts`
- ç±»å‹å®šä¹‰: ä¸ä½¿ç”¨å¤„åŒæ–‡ä»¶

### TypeScript è§„èŒƒ
- ä¸¥æ ¼æ¨¡å¼å¼€å¯
- æ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰ç±»å‹æ³¨è§£
- ä½¿ç”¨ Cloudflare Workers ç±»å‹: `@cloudflare/workers-types`

### è·¯ç”±æ¨¡å¼
```typescript
// æ ‡å‡† Route ç»“æ„
import type { Route } from "./+types/file";

export function meta() {
  return [{ title: "é¡µé¢æ ‡é¢˜" }];
}

export async function loader({ context }: Route.LoaderArgs) {
  const db = context.env.DB as D1Database;
  const data = await getBills(db);
  return data;
}

export async function action({ request, context }: Route.ActionArgs) {
  const formData = await request.formData();
  // å¤„ç†è¡¨å•æäº¤...
}

export default function Component() {
  // UI ç»„ä»¶...
}
```

### è§£æå™¨æ¥å£
```typescript
export interface ParsedBill {
  id: string;
  amount: number;
  description: string;
  transactionDate: string;
  originalData: Record<string, any>;
}

// æ‰€æœ‰è§£æå™¨å¿…é¡»å®ç°æ­¤æ¥å£
export async function parseXXX(file: File): Promise<ParsedBill[]>
```

### æ•°æ®åº“æ“ä½œ
- ä½¿ç”¨ `app/lib/db.ts` ä¸­çš„å‡½æ•°
- æ‰€æœ‰æŸ¥è¯¢å¿…é¡»å‚æ•°åŒ–ï¼ˆé˜² SQL æ³¨å…¥ï¼‰
- é”™è¯¯å¿…é¡»è¢«æ•è·å¹¶å¤„ç†

---

## âš ï¸ å½“å‰å¼€å‘é‡ç‚¹

### é«˜ä¼˜å…ˆçº§ä»»åŠ¡
1. **è´¦å•åˆ—è¡¨é¡µé¢** - åˆ›å»º `bills.list.tsx` å±•ç¤ºå·²ä¸Šä¼ è´¦å•
2. **ç»Ÿè®¡åˆ†æé¡µé¢** - åˆ›å»º `analytics.tsx` å®ç°æ•°æ®å¯è§†åŒ–
3. **è®¾ç½®é¡µé¢** - åˆ›å»º `settings.tsx` ç®¡ç†åˆ†ç±»è§„åˆ™å’Œé¢„ç®—

### ä¸­ä¼˜å…ˆçº§ä»»åŠ¡
4. **AI æ™ºèƒ½åˆ—è¯†åˆ«ï¼ˆæœåŠ¡ç«¯ï¼‰** - å®ç°æœåŠ¡ç«¯ API ç«¯ç‚¹
5. **é”™è¯¯å¤„ç†å®Œå–„** - å¢å¼ºè§£æå™¨å’Œæ–‡ä»¶ä¸Šä¼ çš„é”™è¯¯å¤„ç†
6. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–** - æ·»åŠ åŠ è½½åŠ¨ç”»ã€é”™è¯¯æç¤ºç­‰

è¯¦ç»†ä»»åŠ¡åˆ—è¡¨è§: `REVIEW.md`

---

## âœ… å¾…åŠä»»åŠ¡ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### ç«‹å³å¼€å§‹
1. **å®ç°è´¦å•åˆ—è¡¨é¡µé¢** (1.5å°æ—¶) - å±•ç¤ºå·²ä¸Šä¼ è´¦å•ï¼Œæ”¯æŒç­›é€‰å’Œæœç´¢
2. **å®ç°ç»Ÿè®¡åˆ†æé¡µé¢** (2å°æ—¶) - æ•°æ®å¯è§†åŒ–ï¼Œåˆ†ç±»ç»Ÿè®¡

### åŠŸèƒ½å®Œå–„
3. **å®ç°è®¾ç½®é¡µé¢** (1.5å°æ—¶) - ç®¡ç†åˆ†ç±»è§„åˆ™å’Œé¢„ç®—
4. **æ·»åŠ é”™è¯¯å¤„ç†å’Œæ–‡ä»¶éªŒè¯** (1å°æ—¶) - å¢å¼ºç”¨æˆ·ä½“éªŒ
5. **æœ¬åœ°æµ‹è¯•å®Œæ•´æµç¨‹** (1å°æ—¶) - ç«¯åˆ°ç«¯æµ‹è¯•

### åç»­ä¼˜åŒ–
6. AI æ™ºèƒ½åˆ—è¯†åˆ«ï¼ˆæœåŠ¡ç«¯éƒ¨åˆ†ï¼‰
7. æ·»åŠ å›¾è¡¨å¯è§†åŒ–åº“
8. å®‰å…¨åŠ å›º
9. æ€§èƒ½ä¼˜åŒ–

å®Œæ•´ TODO è§: `REVIEW.md#ä»»åŠ¡æ¸…å•`

---

## ğŸ”‘ é‡è¦çº¦å®š

### Cloudflare ç¯å¢ƒå˜é‡
```typescript
// åœ¨ wrangler.toml ä¸­å®šä¹‰
// åœ¨è·¯ç”±ä¸­é€šè¿‡ context.env è®¿é—®
context.env.DB  // D1Database å®ä¾‹
context.env.BUCKET  // R2Bucket å®ä¾‹
```

### æœ¬åœ°å¼€å‘
```bash
pnpm dev  # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆéœ€è¦å…ˆé…ç½® wranglerï¼‰
```

### ç±»å‹å®šä¹‰ä½ç½®
- Cloudflare Workers ç±»å‹: `@cloudflare/workers-types`
- Route ç±»å‹: React Router è‡ªåŠ¨ç”Ÿæˆåœ¨ `app/routes/+types/*.ts`

### ä¸åšçš„äº‹
- ä¸è¦ä½¿ç”¨ Next.jsï¼ˆç”¨æˆ·æ˜ç¡®æ‹’ç»ï¼‰
- ä¸è¦æ·»åŠ ä¸å¿…è¦çš„ä¾èµ–
- ä¸è¦è¿‡åº¦æŠ½è±¡ï¼ˆä¿æŒç®€å•ï¼‰
- ä¸è¦æ·»åŠ  npm scripts ä¸­æœªå®šä¹‰çš„å‘½ä»¤

---

## ğŸ’¡ å†³ç­–è®°å½•

### ä¸ºä»€ä¹ˆé€‰æ‹© React Router v7 (Remix)?
- ç”¨æˆ·ç†Ÿæ‚‰ Vite + Reactï¼Œæƒ³å­¦ä¹  Remix
- æœåŠ¡å™¨ç«¯å¤„ç†è´¦å•æ–‡ä»¶æ›´é«˜æ•ˆ
- è¡¨å•å¤„ç†ï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰æ›´ä¼˜é›…
- Cloudflare é›†æˆæ›´æˆç†Ÿ

### ä¸ºä»€ä¹ˆä½¿ç”¨ Cloudflare D1 è€Œéå…¶ä»–æ•°æ®åº“?
- ç”¨æˆ·è®¡åˆ’éƒ¨ç½²åˆ° Cloudflare
- D1 å…è´¹é¢åº¦æ…·æ…¨
- SQLite å…¼å®¹ï¼Œæ˜“äºæœ¬åœ°å¼€å‘

### ä¸ºä»€ä¹ˆé€‰æ‹© Tailwind CSS v4?
- å¿«é€Ÿå¼€å‘
- ä¸ Vite é›†æˆå¥½
- ç”¨æˆ·ç†Ÿæ‚‰ï¼ˆä» Vite + React èƒŒæ™¯æ¥ï¼‰

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

### å®˜æ–¹æ–‡æ¡£
- [React Router v7](https://reactrouter.com)
- [Cloudflare Pages](https://developers.cloudflare.com/pages)
- [Cloudflare D1](https://developers.cloudflare.com/d1)
- [Cloudflare Workers](https://developers.cloudflare.com/workers)
- [Tailwind CSS v4](https://tailwindcss.com)

### é¡¹ç›®æ–‡æ¡£
- `README.md` - é¡¹ç›®è¯´æ˜å’Œå¿«é€Ÿå¼€å§‹
- `QUICKSTART.md` - è¯¦ç»†å¼€å‘æŒ‡å—
- `REVIEW.md` - é¡¹ç›®æ€»ç»“ã€é—®é¢˜åˆ†æå’Œ TODO æ¸…å•

---

## ğŸ¯ å¼€å‘ä¼˜å…ˆçº§

### éµå¾ªä»¥ä¸‹åŸåˆ™
1. **å…ˆæ ¸å¿ƒï¼Œåä¼˜åŒ–** - åˆ—è¡¨å±•ç¤ºã€æ•°æ®åˆ†ææ˜¯æ ¸å¿ƒ
2. **å…ˆç®€å•ï¼Œåå®Œå–„** - åŸºç¡€åŠŸèƒ½å®ç°åå†æ·»åŠ é”™è¯¯å¤„ç†
3. **å…ˆæœ¬åœ°ï¼Œåéƒ¨ç½²** - æœ¬åœ°æµ‹è¯•é€šè¿‡åå†è€ƒè™‘éƒ¨ç½²

---

## ğŸ¤– ä¸ Claude åä½œå»ºè®®

### ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦æ›´æ–°æ­¤æ–‡ä»¶
- æŠ€æœ¯æ ˆå‘ç”Ÿå˜åŒ–
- é¡¹ç›®æ¶æ„é‡å¤§è°ƒæ•´
- æ–°å¢é‡è¦çº¦å®š
- è§£å†³å…³é”®é˜»å¡é—®é¢˜

### ä»£ç å®¡æŸ¥é‡ç‚¹
- TypeScript ç±»å‹å®‰å…¨
- é”™è¯¯å¤„ç†æ˜¯å¦å……åˆ†
- Cloudflare é›†æˆæ˜¯å¦æ­£ç¡®
- æ˜¯å¦éµå¾ªç°æœ‰æ¶æ„

### æµ‹è¯•å»ºè®®
- æ¯ä¸ªåŠŸèƒ½å®ç°åç«‹å³æµ‹è¯•
- ä½¿ç”¨çœŸå®çš„æ”¯ä»˜å®/å¾®ä¿¡è´¦å•æ–‡ä»¶æµ‹è¯•è§£æå™¨
- æœ¬åœ°æµ‹è¯•é€šè¿‡åå†è€ƒè™‘éƒ¨ç½²

---

**æœ€åæ›´æ–°**: 2025-01-16
**ç»´æŠ¤è€…**: Hefei
**é¡¹ç›®çŠ¶æ€**: ğŸŸ¢ æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ - å¾…è¡¥å……åˆ—è¡¨å’Œåˆ†æé¡µé¢
