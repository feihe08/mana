# Mana é¡¹ç›®è½¬å‹è°ƒç ”æŠ¥å‘Š

**è°ƒç ”æ—¥æœŸ**: 2026-01-18  
**é¡¹ç›®ç›®æ ‡**: æ”¯æŒå¤šæºè´¦å•å¯¼å…¥ â†’ AI å¤„ç†å»é‡åˆ†ç±» â†’ è½¬æ¢ä¸º Beancount æ ¼å¼ â†’ è´¢åŠ¡åˆ†æ

---

## ğŸ“‹ ç›®å½•

1. [æ ¸å¿ƒéœ€æ±‚åˆ†æ](#1-æ ¸å¿ƒéœ€æ±‚åˆ†æ)
2. [Beancount æ ¼å¼æ·±åº¦è§£æ](#2-beancount-æ ¼å¼æ·±åº¦è§£æ)
3. [é‡å¤æ£€æµ‹æŠ€æœ¯è°ƒç ”](#3-é‡å¤æ£€æµ‹æŠ€æœ¯è°ƒç ”)
4. [AI æ™ºèƒ½å¤„ç†æ–¹æ¡ˆ](#4-ai-æ™ºèƒ½å¤„ç†æ–¹æ¡ˆ)
5. [æŠ€æœ¯æ¶æ„æ–¹æ¡ˆå¯¹æ¯”](#5-æŠ€æœ¯æ¶æ„æ–¹æ¡ˆå¯¹æ¯”)
6. [å®ç°æˆæœ¬è¯„ä¼°](#6-å®ç°æˆæœ¬è¯„ä¼°)
7. [æ¨èæ–¹æ¡ˆåŠå®æ–½è·¯çº¿å›¾](#7-æ¨èæ–¹æ¡ˆåŠå®æ–½è·¯çº¿å›¾)
8. [é£é™©ä¸æŒ‘æˆ˜](#8-é£é™©ä¸æŒ‘æˆ˜)

---

## 1. æ ¸å¿ƒéœ€æ±‚åˆ†æ

### 1.1 ä¸šåŠ¡åœºæ™¯

**å¤šæºè´¦å•å¯¼å…¥**:
- å¾®ä¿¡æ”¯ä»˜è´¦å•
- æ”¯ä»˜å®è´¦å•
- é“¶è¡Œä¿¡ç”¨å¡è´¦å•
- Excel/CSV æ ¼å¼

**æ ¸å¿ƒé—®é¢˜**:
- **æ•°æ®é‡å¤**: å¾®ä¿¡æ”¯ä»˜ä½¿ç”¨ä¿¡ç”¨å¡ä¼šåœ¨ä¸¤ä¸ªè´¦å•ä¸­éƒ½ä½“ç°
- **æ ¼å¼ä¸ç»Ÿä¸€**: ä¸åŒæ¥æºçš„å­—æ®µåã€æ—¥æœŸæ ¼å¼ã€é‡‘é¢è¡¨ç¤ºä¸åŒ
- **è´¦æˆ·æ˜ å°„**: éœ€è¦å°†æ”¯ä»˜æ–¹å¼æ˜ å°„åˆ°å¤å¼è®°è´¦è´¦æˆ·

**è¾“å‡ºç›®æ ‡**:
- è½¬æ¢ä¸º [Beancount](https://github.com/beancount/beancount) æ ¼å¼
- æ”¯æŒå¤å¼è®°è´¦ï¼ˆDouble-Entry Bookkeepingï¼‰
- å¯ç”¨ Beancount ç”Ÿæ€ç³»ç»Ÿå·¥å…·è¿›è¡Œåˆ†æï¼ˆFavaã€æŠ¥è¡¨ç­‰ï¼‰

---

## 2. Beancount æ ¼å¼æ·±åº¦è§£æ

### 2.1 ä»€ä¹ˆæ˜¯ Beancountï¼Ÿ

Beancount æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬çš„å¤å¼è®°è´¦ç³»ç»Ÿï¼Œç”± Martin Blais å¼€å‘ã€‚å®ƒä½¿ç”¨ç®€å•çš„æ–‡æœ¬è¯­æ³•æè¿°è´¢åŠ¡äº¤æ˜“ï¼Œæ”¯æŒï¼š

- å¤å¼è®°è´¦ï¼ˆæ¯ç¬”äº¤æ˜“è‡³å°‘æ¶‰åŠä¸¤ä¸ªè´¦æˆ·ï¼‰
- å¤šå¸ç§æ”¯æŒ
- è‡ªåŠ¨å¹³è¡¡æ£€æŸ¥
- å¼ºå¤§çš„æŸ¥è¯¢å’ŒæŠ¥è¡¨åŠŸèƒ½
- Python æ’ä»¶ç³»ç»Ÿ

### 2.2 åŸºæœ¬è¯­æ³•

#### è´¦æˆ·ç±»å‹ï¼ˆå¿…é¡»ä»¥äº”å¤§ç±»å¼€å¤´ï¼‰

```
Assets:Bank:Checking        # èµ„äº§ï¼šé“¶è¡Œï¼šæ”¯ç¥¨è´¦æˆ·
Liabilities:CreditCard:Visa  # è´Ÿå€ºï¼šä¿¡ç”¨å¡ï¼šVisa
Income:Salary:Tech           # æ”¶å…¥ï¼šå·¥èµ„ï¼šæŠ€æœ¯
Expenses:Food:Groceries      # è´¹ç”¨ï¼šé£Ÿå“ï¼šæ‚è´§
Equity:Opening-Balances      # æƒç›Šï¼šæœŸåˆä½™é¢
```

#### äº¤æ˜“æ ¼å¼

```
2025-01-15 * "è¶…å¸‚åç§°" "è´­ä¹°æ—¥ç”¨å“"
    Expenses:Food:Groceries    150.00 CNY
    Assets:CreditCard:WeChat   -150.00 CNY
```

**è¯­æ³•è¯´æ˜**:
- `YYYY-MM-DD`: äº¤æ˜“æ—¥æœŸ
- `*`: æ ‡è®°ç¬¦å·ï¼ˆ`*` = å·²ç¡®è®¤ï¼Œ`!` = å¾…å®šï¼‰
- `"Payee"`: äº¤æ˜“å¯¹æ‰‹ï¼ˆå¯é€‰ï¼‰
- `"Narration"`: äº¤æ˜“æè¿°
- æ¯è¡Œ posting: `Account Amount Currency`
- **å€Ÿè´·å¿…é¡»å¹³è¡¡**ï¼ˆæ­£è´Ÿé‡‘é¢ä¹‹å’Œä¸º 0ï¼‰

### 2.3 ä¸­æ–‡è´¦æˆ·å‘½åè§„èŒƒ

æ ¹æ®ä¸­æ–‡ä½¿ç”¨ä¹ æƒ¯ï¼Œæ¨èè´¦æˆ·ç»“æ„ï¼š

```
Assets:Bank:æ‹›å•†é“¶è¡Œ         # èµ„äº§ï¼šé“¶è¡Œï¼šæ‹›å•†é“¶è¡Œ
Assets:Alipay:ä½™é¢           # èµ„äº§ï¼šæ”¯ä»˜å®ï¼šä½™é¢
Assets:WeChat:é›¶é’±           # èµ„äº§ï¼šå¾®ä¿¡ï¼šé›¶é’±
Liabilities:CreditCard:æ‹›è¡Œä¿¡ç”¨å¡  # è´Ÿå€ºï¼šä¿¡ç”¨å¡ï¼šæ‹›è¡Œä¿¡ç”¨å¡
Liabilities:Alipay:èŠ±å‘—      # è´Ÿå€ºï¼šæ”¯ä»˜å®ï¼šèŠ±å‘—
Expenses:é¤é¥®:å¤–å–           # è´¹ç”¨ï¼šé¤é¥®ï¼šå¤–å–
Expenses:äº¤é€š:åœ°é“           # è´¹ç”¨ï¼šäº¤é€šï¼šåœ°é“
Income:å·¥èµ„:ä¸»ä¸š             # æ”¶å…¥ï¼šå·¥èµ„ï¼šä¸»ä¸š
```

### 2.4 ç°æœ‰å¯¼å…¥å·¥å…·ç”Ÿæ€

#### Python Importers
- **[china_bean_importers](https://github.com/jiegec/china_bean_importers)** - æ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡çš„ä¸­å›½ç‰ˆ Importer
- **[Beancount-Trans](https://github.com/dhr2333/Beancount-Trans)** - æ”¯ä»˜å®è½¬æ¢å·¥å…·
- **[beancount-ing](https://pypi.org/project/beancount-ing/)** ING é“¶è¡Œå¯¼å…¥å™¨ç¤ºä¾‹
- **é€šç”¨ CSV Importer** - Beancount å®˜æ–¹æ–‡æ¡£æä¾›äº† CSV å¯¼å…¥æŒ‡å—

#### AI è¾…åŠ©å·¥å…·
- **[Beanborg](https://github.com/luciano-fiandesio/beanborg)** - AI é©±åŠ¨çš„è‡ªåŠ¨åˆ†ç±»å™¨ï¼ˆè§„åˆ™ + ML + GPTï¼‰
- **[beancount-categorizer](https://github.com/bratekarate/beancount-categorizer)** - è‡ªåŠ¨åˆ†ç±»è£…é¥°å™¨
- **[Beancount v3.2+](http://beancount.io/forum/t/beancount-v3-2-0-major-release-deep-dive-and-what-it-means-for-users/80)** - å†…ç½® AI æ’ä»¶æ”¯æŒ

### 2.5 Beancount Python API

```python
from beancount.parser import parser

# è§£æ Beancount æ–‡ä»¶
entries, errors, options = parser.parse_string("""
2025-01-15 * "æµ‹è¯•" "æè¿°"
    Expenses:Test  100.00 CNY
    Assets:Bank   -100.00 CNY
""")

# è®¿é—®äº¤æ˜“æ•°æ®
for entry in entries:
    if isinstance(entry, Transaction):
        print(entry.date, entry.narration)
```

---

## 3. é‡å¤æ£€æµ‹æŠ€æœ¯è°ƒç ”

### 3.1 é—®é¢˜åœºæ™¯

**å…¸å‹é‡å¤æ¡ˆä¾‹**:
1. **ä¿¡ç”¨å¡è¿˜æ¬¾**: å¾®ä¿¡æ”¯ä»˜ä¿¡ç”¨å¡ â†’ å¾®ä¿¡è´¦å• + ä¿¡ç”¨å¡è´¦å•éƒ½æœ‰è®°å½•
2. **è·¨å¹³å°æ”¯ä»˜**: æ”¯ä»˜å®ä½™é¢è´­ä¹° â†’ æ”¯ä»˜å®è´¦å• + å•†æˆ·ç³»ç»Ÿè´¦å•
3. **å¯¼å…¥é‡å¤**: åŒä¸€æ–‡ä»¶å¤šæ¬¡å¯¼å…¥

### 3.2 æ£€æµ‹ç®—æ³•

#### ç®—æ³• 1: æ—¶é—´çª—å£ + é‡‘é¢åŒ¹é…

**åŸç†**: ç›¸åŒæ—¶é—´çª—å£å†…ã€ç›¸åŒé‡‘é¢çš„äº¤æ˜“å¯èƒ½æ˜¯é‡å¤

```python
def find_duplicates_by_time_and_amount(transactions, window_hours=24):
    duplicates = []
    for i, t1 in enumerate(transactions):
        for t2 in transactions[i+1:]:
            time_diff = abs((t1.date - t2.date).total_hours())
            amount_match = abs(t1.amount - t2.amount) < 0.01
            
            if time_diff <= window_hours and amount_match:
                duplicates.append((t1, t2))
    return duplicates
```

**ä¼˜ç‚¹**: ç®€å•ã€å¿«é€Ÿã€è¯¯åˆ¤ç‡ä½  
**ç¼ºç‚¹**: æ— æ³•æ£€æµ‹é‡‘é¢ç•¥æœ‰ä¸åŒçš„äº¤æ˜“

#### ç®—æ³• 2: æ¨¡ç³ŠåŒ¹é… (Fuzzy Matching)

**æŠ€æœ¯**: Levenshtein è·ç¦»ã€Jaccard ç›¸ä¼¼åº¦ã€Cosine ç›¸ä¼¼åº¦

```python
from Levenshtein import distance

def description_similarity(desc1, desc2):
    """è®¡ç®—æè¿°ç›¸ä¼¼åº¦ (0-1)"""
    max_len = max(len(desc1), len(desc2))
    if max_len == 0:
        return 1.0
    return 1 - (distance(desc1, desc2) / max_len)

def is_duplicate(t1, t2, threshold=0.8):
    """ç»¼åˆåˆ¤æ–­æ˜¯å¦é‡å¤"""
    time_close = abs((t1.date - t2.date).days) <= 1
    amount_close = abs(t1.amount - t2.amount) < 1.0
    desc_similar = description_similarity(t1.description, t2.description) >= threshold
    
    return time_close and amount_close and desc_similar
```

**å‚è€ƒ**: [Fuzzy Matching Algorithms in Bank Reconciliation](https://optimus.tech/blog/fuzzy-matching-algorithms-in-bank-reconciliation-when-exact-match-fails)

#### ç®—æ³• 3: æ¦‚ç‡åŒ¹é… (Probabilistic Matching)

**æŠ€æœ¯**: åŸºäºè§„åˆ™çš„è¯„åˆ†ç³»ç»Ÿ

```python
def duplicate_score(t1, t2):
    """è®¡ç®—é‡å¤æ¦‚ç‡åˆ†æ•° (0-100)"""
    score = 0
    
    # æ—¶é—´åŒ¹é… (40åˆ†)
    if abs((t1.date - t2.date).hours) <= 1:
        score += 40
    elif abs((t1.date - t2.date).hours) <= 24:
        score += 20
    
    # é‡‘é¢åŒ¹é… (30åˆ†)
    if t1.amount == t2.amount:
        score += 30
    elif abs(t1.amount - t2.amount) < 1:
        score += 15
    
    # æè¿°ç›¸ä¼¼åº¦ (30åˆ†)
    score += description_similarity(t1.description, t2.description) * 30
    
    return score

# é˜ˆå€¼åˆ¤æ–­
if duplicate_score(t1, t2) >= 70:
    mark_as_duplicate(t1, t2)
```

**å‚è€ƒ**: [Transaction Reconciliation Best Practices](https://www.highradius.com/resources/Blog/account-reconciliation-software-use-cases/)

#### ç®—æ³• 4: AI/æœºå™¨å­¦ä¹ æ–¹æ³•

**æŠ€æœ¯**: ä½¿ç”¨è®­ç»ƒæ¨¡å‹é¢„æµ‹é‡å¤

```python
# ç‰¹å¾æå–
features = [
    abs(time_diff_hours),
    abs(amount_diff),
    description_similarity,
    payee_match,
    account_match,
    # ... æ›´å¤šç‰¹å¾
]

# ä½¿ç”¨åˆ†ç±»æ¨¡å‹
model = load_model("duplicate_classifier.pkl")
probability = model.predict_proba([features])[0]

if probability > 0.8:
    mark_as_duplicate()
```

**å‚è€ƒ**: [Record Linkage-Based Data Deduplication](https://www.mdpi.com/2414-4088/6/4/27)

### 3.3 å®é™…åº”ç”¨å»ºè®®

**æ¨èç»„åˆç­–ç•¥**:

1. **ç¬¬ä¸€é˜¶æ®µ**: ç²¾ç¡®åŒ¹é…ï¼ˆæ—¶é—´ Â±1å°æ—¶ï¼Œé‡‘é¢å®Œå…¨ç›¸åŒï¼‰
2. **ç¬¬äºŒé˜¶æ®µ**: æ¨¡ç³ŠåŒ¹é…ï¼ˆæ—¶é—´ Â±24å°æ—¶ï¼Œé‡‘é¢ç›¸ä¼¼ï¼Œæè¿°ç›¸ä¼¼åº¦ > 0.85ï¼‰
3. **ç¬¬ä¸‰é˜¶æ®µ**: AI è¾…åŠ©åˆ¤æ–­ï¼ˆè¾¹ç¼˜æ¡ˆä¾‹ï¼‰
4. **äººå·¥å®¡æ ¸**: ä½ç½®ä¿¡åº¦åŒ¹é…éœ€è¦äººå·¥ç¡®è®¤

---

## 4. AI æ™ºèƒ½å¤„ç†æ–¹æ¡ˆ

### 4.1 AI åœ¨è´¦å•å¤„ç†ä¸­çš„è§’è‰²

#### è§’è‰² 1: è´¦æˆ·åˆ†ç±» (Account Categorization)

**ä»»åŠ¡**: æ ¹æ®äº¤æ˜“æè¿°è‡ªåŠ¨åˆ†é… Beancount è´¦æˆ·

**è¾“å…¥**:
```
æè¿°: "ç¾å›¢å¤–å–"
é‡‘é¢: -35.50 CNY
```

**è¾“å‡º**:
```
Expenses:Food:Delivery
```

**æŠ€æœ¯æ–¹æ¡ˆ**:

**æ–¹æ¡ˆ A: è§„åˆ™å¼•æ“**
```python
RULES = {
    "ç¾å›¢|é¥¿äº†ä¹ˆ": "Expenses:Food:Delivery",
    "æ»´æ»´|æ‰“è½¦": "Expenses:Transport:Taxi",
    "æ·˜å®|äº¬ä¸œ": "Expenses:Shopping:Online",
    # ...
}

def categorize_by_rules(description):
    for pattern, account in RULES.items():
        if re.search(pattern, description):
            return account
    return "Expenses:Uncategorized"
```

**æ–¹æ¡ˆ B: LLM åˆ†ç±»**
```python
import openai

def categorize_by_llm(description):
    prompt = f"""
Classify this transaction into a Beancount account:
Description: {description}

Available accounts:
- Expenses:Food:Groceries
- Expenses:Food:Delivery
- Expenses:Transport:Taxi
- ...

Return only the account name.
"""
    response = openai.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "user", "content": prompt}]
    )
    return response.choices[0].message.content
```

**æ–¹æ¡ˆ C: æ··åˆæ–¹æ¡ˆï¼ˆæ¨èï¼‰**
```python
def smart_categorize(description):
    # 1. å…ˆå°è¯•è§„åˆ™åŒ¹é…ï¼ˆå¿«é€Ÿã€å‡†ç¡®ï¼‰
    result = categorize_by_rules(description)
    if result != "Expenses:Uncategorized":
        return result
    
    # 2. è§„åˆ™å¤±è´¥æ—¶ä½¿ç”¨ LLM
    return categorize_by_llm(description)
```

**å‚è€ƒ**:
- [Beanborg](https://github.com/luciano-fiandesio/beanborg) - æ··åˆæ–¹æ¡ˆçš„å®ç°
- [Using LLMs to Automate Bookkeeping](https://beancount.io/docs/Solutions/using-llms-to-automate-and-enhance-bookkeeping-with-beancount)
- [95% è‡ªåŠ¨åˆ†ç±»æˆåŠŸæ¡ˆä¾‹](https://beancount.io/forum/t/finally-got-95-automated-expense-categorization-working-with-beancount-llms/93)

#### è§’è‰² 2: äº¤æ˜“å¯¹æ‰‹æå– (Payee Extraction)

**ä»»åŠ¡**: ä»æè¿°ä¸­æå–å•†å®¶/æœåŠ¡åç§°

**è¾“å…¥**:
```
"ç¾å›¢å¤–å–-åŒ—äº¬æœé˜³åº—è®¢å•123456"
```

**è¾“å‡º**:
```
Payee: "ç¾å›¢å¤–å–"
Narration: "åŒ—äº¬æœé˜³åº—"
```

#### è§’è‰² 3: å¤å¼è®°è´¦å»ºè®® (Posting Suggestions)

**ä»»åŠ¡**: è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„å¤å¼è®°è´¦ entry

**è¾“å…¥**:
```
æ”¯ä»˜å®äº¤æ˜“: -100.00 CNY, "è¶…å¸‚è´­ç‰©"
```

**è¾“å‡º**:
```
2025-01-15 * "è¶…å¸‚" "è´­ç‰©"
    Expenses:Food:Groceries  100.00 CNY
    Assets:Alipay:Balance   -100.00 CNY
```

**æ™ºèƒ½ç‚¹**: æ ¹æ®å†å²æ•°æ®å’Œæ”¯ä»˜æ–¹å¼æ¨æµ‹å¯¹æ–¹è´¦æˆ·

### 4.2 AI æ¨¡å‹é€‰æ‹©

| æ¨¡å‹ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **è§„åˆ™å¼•æ“** | å¿«é€Ÿã€å…è´¹ã€å¯æ§ | éœ€è¦æ‰‹å·¥ç»´æŠ¤è§„åˆ™ | é«˜é¢‘ã€å›ºå®šçš„äº¤æ˜“ç±»å‹ |
| **GPT-4o** | å‡†ç¡®ç‡é«˜ã€ç†è§£èƒ½åŠ›å¼º | æœ‰æˆæœ¬ã€å»¶è¿Ÿé«˜ | å¤æ‚äº¤æ˜“ã€è¾¹ç¼˜æ¡ˆä¾‹ |
| **Claude 3.5** | ä¸Šä¸‹æ–‡é•¿ã€ä¸­æ–‡å¥½ | API ç¨³å®šæ€§ | ä¸­æ–‡è´¦å•ã€æ‰¹é‡å¤„ç† |
| **å¾®è°ƒçš„å°æ¨¡å‹** | å¿«é€Ÿã€ä¾¿å®œ | éœ€è¦è®­ç»ƒæ•°æ® | ç‰¹å®šæœºæ„ã€å¤§è§„æ¨¡ |

**æ¨è**: **è§„åˆ™ + GPT-4o æ··åˆæ–¹æ¡ˆ**

### 4.3 æˆåŠŸæ¡ˆä¾‹

æ ¹æ® [Beancount ç¤¾åŒºæŠ¥å‘Š](https://beancount.io/forum/t/finally-got-95-automated-expense-categorization-working-with-beancount-llms/93)ï¼š
- **95% è‡ªåŠ¨åˆ†ç±»å‡†ç¡®ç‡** å¯å®ç°
- å…³é”®ï¼šæŒç»­çš„è§„åˆ™ä¼˜åŒ– + LLM fallback
- å¤„ç†æ—¶é—´ï¼šçº¦ 3 ä¸ªæœˆè¿­ä»£è¾¾åˆ°ç¨³å®šçŠ¶æ€

---

## 5. æŠ€æœ¯æ¶æ„æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ A: çº¯æµè§ˆå™¨ç«¯å¤„ç†

#### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Browser (React Router v7)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æ–‡ä»¶ä¸Šä¼  (CSV/Excel)                    â”‚
â”‚  2. å®¢æˆ·ç«¯è§£æ (papaparse, xlsx)            â”‚
â”‚  3. AI å¤„ç† (è°ƒç”¨ OpenAI/Claude API)         â”‚
â”‚  4. é‡å¤æ£€æµ‹ (JavaScript ç®—æ³•)               â”‚
â”‚  5. ç”Ÿæˆ Beancount æ–‡æœ¬                     â”‚
â”‚  6. ä¸‹è½½ .beancount æ–‡ä»¶                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: React Router v7 + TypeScript
- **æ–‡ä»¶è§£æ**: papaparse (CSV), xlsx (Excel)
- **AI API**: OpenAI/Claude HTTP API
- **ä¸‹è½½**: Blob + URL.createObjectURL

#### ä¼˜ç‚¹
âœ… æ— æœåŠ¡ç«¯æˆæœ¬  
âœ… æ•°æ®éšç§ï¼ˆä¸ä¸Šä¼ è´¦å•ï¼‰  
âœ… éƒ¨ç½²ç®€å•ï¼ˆCloudflare Pagesï¼‰  
âœ… åˆ©ç”¨ç°æœ‰ä»£ç åŸºç¡€

#### ç¼ºç‚¹
âŒ AI API æˆæœ¬ï¼ˆç”¨æˆ·éœ€è‡ªå·±æä¾› API Keyï¼‰  
âŒ æ— æ³•å¤„ç†å¤§æ–‡ä»¶ï¼ˆæµè§ˆå™¨å†…å­˜é™åˆ¶ï¼‰  
âŒ æ— æ³•ä¿å­˜å†å²æ•°æ®  
âŒ æ— æ•°æ®æŒä¹…åŒ–

#### é€‚ç”¨åœºæ™¯
- **ä¸ªäººå·¥å…·**: ç”¨æˆ·å¶å°”å¯¼å…¥è´¦å•
- **éšç§æ•æ„Ÿ**: ä¸æƒ³ä¸Šä¼ æ•°æ®åˆ°æœåŠ¡å™¨
- **MVP é˜¶æ®µ**: å¿«é€ŸéªŒè¯åŠŸèƒ½

---

### æ–¹æ¡ˆ B: Cloudflare Workers + Python (Pyodide)

#### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  Cloudflare Workers          â”‚
â”‚              â”‚       â”‚  (Python via Pyodide/WASM)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       â”‚  1. æ¥æ”¶æ–‡ä»¶ä¸Šä¼               â”‚
                       â”‚  2. Python å¤„ç†:              â”‚
                       â”‚     - beancount parser        â”‚
                       â”‚     - é‡å¤æ£€æµ‹ç®—æ³•            â”‚
                       â”‚     - AI åˆ†ç±»                â”‚
                       â”‚  3. å­˜å‚¨åˆ° D1 æ•°æ®åº“          â”‚
                       â”‚  4. è¿”å› Beancount æ–‡æœ¬       â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  D1 Database     â”‚
                       â”‚  - åŸå§‹è´¦å•      â”‚
                       â”‚  - å»é‡ç»“æœ      â”‚
                       â”‚  - åˆ†ç±»è§„åˆ™      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€æœ¯æ ˆ
- **Workers Runtime**: Python via [Pyodide](https://developers.cloudflare.com/workers/languages/python/how-python-workers-work/)
- **æ•°æ®åº“**: Cloudflare D1 (SQLite)
- **Beancount**: Python `beancount` åŒ…
- **AI**: Cloudflare AI (@cf/meta/llama-3.1-8b-instruct)

#### ä¼˜ç‚¹
âœ… æœåŠ¡ç«¯å¤„ç†ï¼ˆæ— å†…å­˜é™åˆ¶ï¼‰  
âœ… æ•°æ®æŒä¹…åŒ–  
âœ… å¯å¤ç”¨å†å²åˆ†ç±»  
âœ… Cloudflare AI å…è´¹é¢åº¦  
âœ… Python ç”Ÿæ€ï¼ˆbeancount åº“ï¼‰

#### ç¼ºç‚¹
âŒ Pyodide é™åˆ¶ï¼ˆä¸æ”¯æŒæ‰€æœ‰ Python åŒ…ï¼‰  
âŒ WASM å¯åŠ¨å»¶è¿Ÿï¼ˆé¦–æ¬¡å†·å¯åŠ¨æ…¢ï¼‰  
âŒ D1 æ•°æ®åº“å¤§å°é™åˆ¶ï¼ˆ5GBï¼‰  
âŒ å¤æ‚åº¦é«˜

#### å…³é”®æŠ€æœ¯ç‚¹

**Pyodide é™åˆ¶** ([å®˜æ–¹æ–‡æ¡£](https://pyodide.org/en/stable/usage/wasm-constraints.html)):
- ä¸æ”¯æŒçº¿ç¨‹/å¤šè¿›ç¨‹
- ä¸æ”¯æŒ C æ‰©å±•æ¨¡å—ï¼ˆé™¤éé¢„ç¼–è¯‘ï¼‰
- æ–‡ä»¶ç³»ç»Ÿå—é™ï¼ˆå†…å­˜è™šæ‹Ÿï¼‰
- ç½‘ç»œ I/O éœ€é€šè¿‡ JavaScript bridge

**D1 æ•°æ®åº“é™åˆ¶**:
- å…è´¹ç‰ˆï¼š5GB å­˜å‚¨
- è¯»å–ï¼š5,000/å¤©
- å†™å…¥ï¼š100,000/å¤©
- å•ä¸ªæŸ¥è¯¢ç»“æœå¤§å°ï¼š2MB

#### é€‚ç”¨åœºæ™¯
- **éœ€è¦å†å²æ•°æ®**: æŒç»­ä½¿ç”¨ï¼Œç§¯ç´¯åˆ†ç±»è§„åˆ™
- **AI å¤„ç†**: å¤æ‚çš„å»é‡å’Œåˆ†ç±»é€»è¾‘
- **å¤šç”¨æˆ·**: å…±äº«åˆ†ç±»è§„åˆ™

---

### æ–¹æ¡ˆ C: æ··åˆæ¶æ„ï¼ˆæ¨èï¼‰

#### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  Cloudflare Workers (JS)     â”‚
â”‚              â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - è½»é‡è§£æ   â”‚       â”‚  1. æ–‡ä»¶æ¥æ”¶å’Œåˆæ­¥è§£æ        â”‚
â”‚ - AI è°ƒç”¨    â”‚       â”‚  2. è°ƒç”¨ AI API              â”‚
â”‚ - UI å±•ç¤º    â”‚       â”‚  3. è½»é‡å»é‡ï¼ˆæ—¶é—´+é‡‘é¢ï¼‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  4. ç”Ÿæˆ Beancount æ–‡æœ¬       â”‚
                       â”‚  5. å­˜å‚¨åˆ° D1ï¼ˆå¯é€‰ï¼‰         â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  External Services    â”‚
                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       â”‚  - OpenAI/Claude API â”‚
                       â”‚  - Cloudflare AI     â”‚
                       â”‚  - (å¯é€‰) Python API â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒè®¾è®¡æ€æƒ³

**åˆ†å±‚å¤„ç†**:

1. **å®¢æˆ·ç«¯ (Browser)**
   - æ–‡ä»¶è§£æï¼ˆCSV/Excelï¼‰
   - UI äº¤äº’
   - AI API è°ƒç”¨ï¼ˆç”¨æˆ· Keyï¼‰
   - æœ¬åœ°ç¼“å­˜

2. **æœåŠ¡ç«¯ (Cloudflare Workers - JavaScript)**
   - æ–‡ä»¶ä¸Šä¼ å¤„ç†
   - è½»é‡å»é‡ç®—æ³•ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
   - D1 æ•°æ®å­˜å‚¨ï¼ˆå¯é€‰ï¼‰
   - Beancount æ–‡æœ¬ç”Ÿæˆ

3. **å¤–éƒ¨ AI API**
   - ä¼˜å…ˆï¼šCloudflare AIï¼ˆå¿«ã€ä¾¿å®œï¼‰
   - Fallbackï¼šOpenAI/Claudeï¼ˆå‡†ç¡®ï¼‰

#### ä¼˜ç‚¹
âœ… çµæ´»æ€§é«˜ï¼ˆæ¸è¿›å¢å¼ºï¼‰  
âœ… æˆæœ¬å¯æ§  
âœ… åˆ©ç”¨ç°æœ‰åŸºç¡€  
âœ… å¯é€‰æ‹©æ€§æŒä¹…åŒ–

#### ç¼ºç‚¹
âš ï¸ éœ€è¦å¤„ç†å¤šç§ AI æä¾›å•†  
âš ï¸ å»é‡èƒ½åŠ›å—é™äº JS è¿è¡Œæ—¶

---

## 6. å®ç°æˆæœ¬è¯„ä¼°

### 6.1 å¼€å‘æ—¶é—´ä¼°ç®—

| ä»»åŠ¡ | æ–¹æ¡ˆ A | æ–¹æ¡ˆ B | æ–¹æ¡ˆ C |
|------|--------|--------|--------|
| **æ–‡ä»¶è§£æ** | 1å¤© | 1å¤© | 1å¤© |
| **Beancount ç”Ÿæˆå™¨** | 2å¤© | 1å¤© | 2å¤© |
| **é‡å¤æ£€æµ‹ç®—æ³•** | 2å¤© | 3å¤© | 2å¤© |
| **AI åˆ†ç±»é›†æˆ** | 2å¤© | 3å¤© | 2å¤© |
| **æ•°æ®æŒä¹…åŒ–** | - | 3å¤© | 2å¤©ï¼ˆå¯é€‰ï¼‰ |
| **UI å¼€å‘** | 3å¤© | 3å¤© | 3å¤© |
| **æµ‹è¯•è°ƒè¯•** | 2å¤© | 4å¤© | 3å¤© |
| **æ€»è®¡** | **12å¤©** | **18å¤©** | **15å¤©** |

### 6.2 è¿è¥æˆæœ¬ï¼ˆæœˆï¼‰

| é¡¹ç›® | æ–¹æ¡ˆ A | æ–¹æ¡ˆ B | æ–¹æ¡ˆ C |
|------|--------|--------|--------|
| **Cloudflare Pages** | $0 | $0 | $0 |
| **Cloudflare Workers** | - | $5 (100k è¯·æ±‚) | $5 (100k è¯·æ±‚) |
| **D1 æ•°æ®åº“** | - | $0 (å…è´¹ 5GB) | $0 (å…è´¹ 5GB) |
| **AI API** | $5-20 | $5-20 | $5-20 |
| **æ€»è®¡** | **$5-20** | **$10-25** | **$10-25** |

**AI API æˆæœ¬æ˜ç»†**ï¼ˆä»¥å¤„ç† 1000 ç¬”äº¤æ˜“/æœˆä¸ºä¾‹ï¼‰:

- **Cloudflare AI** (Llama 3.1 8B): ~$2-5
- **OpenAI GPT-4o**: ~$10-20
- **Claude 3.5 Sonnet**: ~$8-15

### 6.3 æŠ€æœ¯å€ºåŠ¡

| æ–¹æ¡ˆ | ç»´æŠ¤æˆæœ¬ | æ‰©å±•æ€§ | é£é™© |
|------|----------|--------|------|
| **æ–¹æ¡ˆ A** | ä½ | ä½ | ä½ |
| **æ–¹æ¡ˆ B** | é«˜ | é«˜ | é«˜ï¼ˆPyodide é™åˆ¶ï¼‰ |
| **æ–¹æ¡ˆ C** | ä¸­ | ä¸­ | ä¸­ |

---

## 7. æ¨èæ–¹æ¡ˆåŠå®æ–½è·¯çº¿å›¾

### 7.1 æ¨èæ–¹æ¡ˆï¼š**æ–¹æ¡ˆ Cï¼ˆæ··åˆæ¶æ„ï¼‰**

**ç†ç”±**:
1. âœ… **å¹³è¡¡æ€§**: åœ¨æˆæœ¬ã€åŠŸèƒ½ã€å¤æ‚åº¦ä¹‹é—´å–å¾—å¹³è¡¡
2. âœ… **çµæ´»æ€§**: å¯ä»¥æ¸è¿›å¼æ·»åŠ åŠŸèƒ½ï¼ˆå…ˆç®€å•åå¤æ‚ï¼‰
3. âœ… **å¯ç»´æŠ¤**: åŸºäºç°æœ‰ JavaScript æŠ€æœ¯æ ˆ
4. âœ… **ç”¨æˆ·é€‰æ‹©**: ç”¨æˆ·å¯é€‰æ‹©æ˜¯å¦æŒä¹…åŒ–æ•°æ®
5. âœ… **é£é™©å¯æ§**: é¿å…æ–¹æ¡ˆ B çš„ Pyodide é™åˆ¶é£é™©

### 7.2 åˆ†é˜¶æ®µå®æ–½è·¯çº¿å›¾

#### ç¬¬ä¸€é˜¶æ®µï¼šMVPï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰- 2å‘¨

**ç›®æ ‡**: èƒ½å°†å•æºè´¦å•è½¬æ¢ä¸º Beancount æ ¼å¼

**åŠŸèƒ½**:
- âœ… æ”¯æŒå•æ–‡ä»¶ä¸Šä¼ ï¼ˆCSV/Excelï¼‰
- âœ… åŸºç¡€è§£æï¼ˆæå–æ—¥æœŸã€é‡‘é¢ã€æè¿°ï¼‰
- âœ… ç®€å•è§„åˆ™åˆ†ç±»ï¼ˆå…³é”®è¯åŒ¹é…ï¼‰
- âœ… ç”Ÿæˆ Beancount æ–‡æœ¬
- âœ… ä¸‹è½½ .beancount æ–‡ä»¶

**ä¸åŒ…å«**:
- âŒ é‡å¤æ£€æµ‹
- âŒ AI åˆ†ç±»
- âŒ æ•°æ®æŒä¹…åŒ–
- âŒ å¤šæºåˆå¹¶

**æŠ€æœ¯å®ç°**:
- çº¯æµè§ˆå™¨ç«¯å¤„ç†
- å¤ç”¨ç°æœ‰è§£æå™¨ï¼ˆ`parsers/`ï¼‰
- æ–°å¢ `lib/beancount/generator.ts`

#### ç¬¬äºŒé˜¶æ®µï¼šå¢å¼ºåŠŸèƒ½ - 3å‘¨

**ç›®æ ‡**: æ·»åŠ æ™ºèƒ½åˆ†ç±»å’Œé‡å¤æ£€æµ‹

**æ–°å¢åŠŸèƒ½**:
- âœ… AI è‡ªåŠ¨åˆ†ç±»ï¼ˆç”¨æˆ· API Keyï¼‰
- âœ… ç²¾ç¡®é‡å¤æ£€æµ‹ï¼ˆæ—¶é—´ + é‡‘é¢ï¼‰
- âœ… å¤šæ–‡ä»¶ä¸Šä¼ 
- âœ… é¢„è§ˆå’Œç¼–è¾‘ç•Œé¢
- âœ… åˆ†ç±»è§„åˆ™ç®¡ç†

**æŠ€æœ¯å®ç°**:
- Workers API ç«¯ç‚¹ï¼ˆAI è°ƒç”¨ï¼‰
- å®¢æˆ·ç«¯å»é‡ç®—æ³•
- è§„åˆ™å¼•æ“ + LLM fallback

#### ç¬¬ä¸‰é˜¶æ®µï¼šæ•°æ®æŒä¹…åŒ– - 2å‘¨

**ç›®æ ‡**: å¯é€‰çš„å†å²æ•°æ®å’Œè§„åˆ™å­˜å‚¨

**æ–°å¢åŠŸèƒ½**:
- âœ… D1 æ•°æ®åº“é›†æˆ
- âœ… ç”¨æˆ·é…ç½®ï¼ˆAPI Keyã€åˆ†ç±»è§„åˆ™ï¼‰
- âœ… å†å²å¯¼å…¥è®°å½•
- âœ… åˆ†ç±»ç»Ÿè®¡

**æŠ€æœ¯å®ç°**:
- D1 schema è®¾è®¡
- Workers CRUD API
- ç”¨æˆ·è®¤è¯ï¼ˆå¯é€‰ï¼‰

#### ç¬¬å››é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½ - 3å‘¨

**ç›®æ ‡**: å®Œæ•´çš„å¤šæºè´¦å•å¤„ç†

**æ–°å¢åŠŸèƒ½**:
- âœ… å¤šæºåˆå¹¶ï¼ˆå¾®ä¿¡ + æ”¯ä»˜å® + é“¶è¡Œï¼‰
- âœ… é«˜çº§é‡å¤æ£€æµ‹ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰
- âœ… è·¨è´¦æˆ·å¯¹è´¦
- âœ… å¯¼å…¥å‘å¯¼
- âœ… é”™è¯¯è¯Šæ–­å’Œä¿®å¤å»ºè®®

**æŠ€æœ¯å®ç°**:
- æ¨¡ç³ŠåŒ¹é…ç®—æ³•ï¼ˆå¯é€‰ Python å¾®æœåŠ¡ï¼‰
- å¯¹è´¦å¼•æ“
- UI ä¼˜åŒ–

### 7.3 æŠ€æœ¯é€‰å‹ç»†åŒ–

#### æ ¸å¿ƒä¾èµ–

```typescript
// ç°æœ‰ï¼ˆä¿ç•™ï¼‰
{
  "react-router": "^7.0.0",
  "papaparse": "^5.4.0",
  "xlsx": "^0.18.5"
}

// æ–°å¢
{
  "date-fns": "^3.0.0",           // æ—¥æœŸå¤„ç†
  "fuse.js": "^7.0.0",            // æ¨¡ç³Šæœç´¢
  "zod": "^3.22.0",               // æ•°æ®éªŒè¯
  "openai": "^4.0.0",             // AI APIï¼ˆå®¢æˆ·ç«¯ï¼‰
  "@anthropic-ai/sdk": "^0.30.0"  // Claude APIï¼ˆå®¢æˆ·ç«¯ï¼‰
}
```

#### ç›®å½•ç»“æ„

```
app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ _index.tsx              # é¦–é¡µ
â”‚   â”œâ”€â”€ convert.new.tsx         # è½¬æ¢é¡µé¢ï¼ˆä¸Šä¼ ï¼‰
â”‚   â””â”€â”€ convert.preview.tsx     # é¢„è§ˆå’Œç¼–è¾‘
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ parsers/                # ç°æœ‰è§£æå™¨
â”‚   â”œâ”€â”€ beancount/              # æ–°å¢ï¼šBeancount ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ generator.ts        # ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ account-mapper.ts   # è´¦æˆ·æ˜ å°„
â”‚   â”‚   â””â”€â”€ validator.ts        # è¯­æ³•éªŒè¯
â”‚   â”œâ”€â”€ dedup/                  # æ–°å¢ï¼šé‡å¤æ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ exact-match.ts      # ç²¾ç¡®åŒ¹é…
â”‚   â”‚   â”œâ”€â”€ fuzzy-match.ts      # æ¨¡ç³ŠåŒ¹é…
â”‚   â”‚   â””â”€â”€ scorer.ts           # è¯„åˆ†ç®—æ³•
â”‚   â”œâ”€â”€ ai/                     # æ–°å¢ï¼šAI å¤„ç†
â”‚   â”‚   â”œâ”€â”€ categorizer.ts      # åˆ†ç±»å™¨
â”‚   â”‚   â”œâ”€â”€ payee-extractor.ts  # äº¤æ˜“å¯¹æ‰‹æå–
â”‚   â”‚   â””â”€â”€ providers/          # AI æä¾›å•†
â”‚   â”‚       â”œâ”€â”€ openai.ts
â”‚   â”‚       â”œâ”€â”€ claude.ts
â”‚   â”‚       â””â”€â”€ cloudflare.ts
â”‚   â””â”€â”€ db/                     # æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ components/
    â”œâ”€â”€ beancount-editor/       # Beancount ç¼–è¾‘å™¨
    â”œâ”€â”€ account-selector/       # è´¦æˆ·é€‰æ‹©å™¨
    â””â”€â”€ duplicate-viewer/       # é‡å¤é¡¹æŸ¥çœ‹å™¨
```

---

## 8. é£é™©ä¸æŒ‘æˆ˜

### 8.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| **Beancount è¯­æ³•é”™è¯¯** | é«˜ | ä¸¥æ ¼çš„éªŒè¯å™¨ + äººå·¥å®¡æ ¸ |
| **AI åˆ†ç±»ä¸å‡†ç¡®** | ä¸­ | è§„åˆ™ä¼˜å…ˆ + æŒç»­ä¼˜åŒ– |
| **é‡å¤æ£€æµ‹è¯¯åˆ¤** | ä¸­ | ä½é˜ˆå€¼ + äººå·¥ç¡®è®¤ |
| **è·¨è´¦æˆ·å¯¹è´¦å¤æ‚** | é«˜ | æ¸è¿›å¼å®ç° + ç”¨æˆ·å·¥å…· |
| **æ–‡ä»¶æ ¼å¼å¤šæ ·æ€§** | ä½ | AI åˆ—è¯†åˆ« + ç”¨æˆ·æ˜ å°„ |

### 8.2 ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| **ç”¨æˆ·æ•°æ®éšç§** | é«˜ | ç«¯åˆ°ç«¯åŠ å¯† + æœ¬åœ°ä¼˜å…ˆ |
| **AI API æˆæœ¬** | ä¸­ | ç”¨æˆ·è‡ªå¸¦ Key + Cloudflare AI |
| **å­¦ä¹ æ›²çº¿é™¡å³­** | ä¸­ | è¯¦ç»†æ–‡æ¡£ + ç¤ºä¾‹ |
| **Beancount ç”Ÿæ€å°ä¼—** | ä½ | å¯¼å‡º + æ ‡å‡†æ ¼å¼æ”¯æŒ |

### 8.3 ä¾èµ–é£é™©

| ä¾èµ– | é£é™©ç­‰çº§ | è¯´æ˜ |
|------|----------|------|
| **Cloudflare Workers** | ä½ | æˆç†Ÿç¨³å®š |
| **OpenAI/Claude API** | ä¸­ | æœåŠ¡å¯ç”¨æ€§ã€ä»·æ ¼å˜åŠ¨ |
| **Beancount Python åº“** | ä½ | æˆç†Ÿã€æ´»è·ƒç»´æŠ¤ |
| **Pyodide** | é«˜ | é™åˆ¶å¤šï¼Œæ–¹æ¡ˆ B é£é™© |

### 8.4 æ¨èé£é™©åº”å¯¹

1. **æŠ€æœ¯é€‰å‹**: é¿å…æ–¹æ¡ˆ Bï¼ˆPyodideï¼‰ï¼Œé€‰æ‹©æ–¹æ¡ˆ Cï¼ˆæ··åˆï¼‰
2. **æ•°æ®éšç§**: é»˜è®¤æœ¬åœ°å¤„ç†ï¼Œå¯é€‰äº‘ç«¯
3. **API æˆæœ¬**: ç”¨æˆ·è‡ªå¸¦ API Keyï¼Œé¡¹ç›®æä¾› Cloudflare AI fallback
4. **ç”¨æˆ·æ•™è‚²**: æä¾›è¯¦ç»†çš„ Beancount å…¥é—¨æŒ‡å—

---

## 9. å…³é”®å†³ç­–ç‚¹ï¼ˆéœ€è¦ç”¨æˆ·ç¡®è®¤ï¼‰

### 9.1 åŠŸèƒ½èŒƒå›´

**é—®é¢˜ 1**: æ˜¯å¦éœ€è¦æ•°æ®æŒä¹…åŒ–ï¼Ÿ

- **é€‰é¡¹ A**: çº¯å·¥å…·å‹ï¼ˆæ— æ•°æ®åº“ï¼Œæ¯æ¬¡é‡æ–°å¤„ç†ï¼‰
- **é€‰é¡¹ B**: å¯é€‰æŒä¹…åŒ–ï¼ˆç”¨æˆ·é€‰æ‹©æ˜¯å¦ä¿å­˜ï¼‰
- **é€‰é¡¹ C**: å®Œæ•´å¹³å°ï¼ˆå¼ºåˆ¶ä¿å­˜ï¼Œå¤šç”¨æˆ·ï¼‰

**æ¨è**: **é€‰é¡¹ B** - çµæ´»æ€§æœ€é«˜

**é—®é¢˜ 2**: AI åˆ†ç±»ç­–ç•¥ï¼Ÿ

- **é€‰é¡¹ A**: ä»…è§„åˆ™å¼•æ“ï¼ˆå…è´¹ã€å¿«é€Ÿï¼‰
- **é€‰é¡¹ B**: ç”¨æˆ·è‡ªå¸¦ API Keyï¼ˆéšç§ã€çµæ´»ï¼‰
- **é€‰é¡¹ C**: é¡¹ç›®æä¾› Cloudflare AIï¼ˆç®€å•ã€æœ‰æˆæœ¬ï¼‰

**æ¨è**: **é€‰é¡¹ B + C** - é»˜è®¤ Cloudflare AIï¼Œæ”¯æŒè‡ªå®šä¹‰ Key

**é—®é¢˜ 3**: é‡å¤æ£€æµ‹æ·±åº¦ï¼Ÿ

- **é€‰é¡¹ A**: ç²¾ç¡®åŒ¹é…ï¼ˆæ—¶é—´ Â±1hï¼Œé‡‘é¢ç›¸åŒï¼‰
- **é€‰é¡¹ B**: æ¨¡ç³ŠåŒ¹é…ï¼ˆæ—¶é—´ Â±24hï¼Œæè¿°ç›¸ä¼¼åº¦ï¼‰
- **é€‰é¡¹ C**: AI åˆ¤æ–­ï¼ˆé«˜å‡†ç¡®ç‡ã€æœ‰å»¶è¿Ÿï¼‰

**æ¨è**: **é€‰é¡¹ A + B** - åˆ†å±‚å¤„ç†

### 9.2 æŠ€æœ¯é€‰å‹

**é—®é¢˜ 4**: Beancount ç”Ÿæˆæ–¹å¼ï¼Ÿ

- **é€‰é¡¹ A**: çº¯å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆç®€å•ï¼‰
- **é€‰é¡¹ B**: ä½¿ç”¨ Python beancount åº“ï¼ˆå®Œæ•´ï¼‰
- **é€‰é¡¹ C**: è‡ªå»º ASTï¼ˆä¸­é—´è·¯çº¿ï¼‰

**æ¨è**: **é€‰é¡¹ A** â†’ **é€‰é¡¹ C**ï¼ˆæ¸è¿›ï¼‰

**é—®é¢˜ 5**: è´¦æˆ·æ˜ å°„æ–¹å¼ï¼Ÿ

- **é€‰é¡¹ A**: é¢„è®¾æ˜ å°„è¡¨ï¼ˆç®€å•ï¼‰
- **é€‰é¡¹ B**: AI è‡ªåŠ¨æ˜ å°„ï¼ˆæ™ºèƒ½ï¼‰
- **é€‰é¡¹ C**: ç”¨æˆ·é…ç½®ï¼ˆçµæ´»ï¼‰

**æ¨è**: **é€‰é¡¹ A + C** - é¢„è®¾é»˜è®¤ï¼Œç”¨æˆ·å¯ä¿®æ”¹

### 9.3 å®æ–½ä¼˜å…ˆçº§

**é—®é¢˜ 6**: æœ€å°å¯è¡Œäº§å“ï¼ˆMVPï¼‰èŒƒå›´ï¼Ÿ

**å¿…éœ€**:
- âœ… å•æ–‡ä»¶ä¸Šä¼ 
- âœ… åŸºç¡€è§£æ
- âœ… Beancount ç”Ÿæˆ
- âœ… ä¸‹è½½åŠŸèƒ½

**å¯é€‰**:
- âš ï¸ é‡å¤æ£€æµ‹
- âš ï¸ AI åˆ†ç±»
- âš ï¸ æ•°æ®æŒä¹…åŒ–

**å»ºè®®**: ç¬¬ä¸€é˜¶æ®µåªåšå¿…éœ€åŠŸèƒ½ï¼ŒéªŒè¯éœ€æ±‚

---

## 10. ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### 10.1 ç«‹å³å¼€å§‹ï¼ˆæ¨èï¼‰

1. âœ… **ç¡®è®¤æ–¹æ¡ˆ C** - ç”¨æˆ·åŒæ„æ··åˆæ¶æ„
2. âœ… **ç¡®å®š MVP èŒƒå›´** - æ˜ç¡®ç¬¬ä¸€é˜¶æ®µåŠŸèƒ½
3. âœ… **åˆ›å»ºæŠ€æœ¯åŸå‹** - Beancount ç”Ÿæˆå™¨ demo
4. âœ… **è®¾è®¡æ•°æ®ç»“æ„** - è´¦æˆ·æ˜ å°„è¡¨ã€è§„åˆ™å¼•æ“

### 10.2 æŠ€æœ¯å‡†å¤‡

1. **æ­å»ºæœ¬åœ° Beancount ç¯å¢ƒ**
   ```bash
   pip install beancount fava
   # æµ‹è¯•è¯­æ³•å’ŒåŠŸèƒ½
   ```

2. **å‡†å¤‡æµ‹è¯•æ•°æ®**
   - å¾®ä¿¡è´¦å•æ ·æœ¬
   - æ”¯ä»˜å®è´¦å•æ ·æœ¬
   - ä¿¡ç”¨å¡è´¦å•æ ·æœ¬

3. **è®¾è®¡è´¦æˆ·ä½“ç³»**
   - æ ¹æ®ä¸ªäººè´¢åŠ¡æƒ…å†µè®¾è®¡è´¦æˆ·æ ‘
   - ç¼–å†™ mapping é…ç½®æ–‡ä»¶

### 10.3 å¼€å‘è®¡åˆ’ï¼ˆç¬¬ä¸€é˜¶æ®µ MVPï¼‰

**Week 1**:
- Day 1-2: Beancount ç”Ÿæˆå™¨
- Day 3-4: è´¦æˆ·æ˜ å°„å’Œè§„åˆ™å¼•æ“
- Day 5-7: UI å¼€å‘ï¼ˆä¸Šä¼ ã€é¢„è§ˆï¼‰

**Week 2**:
- Day 8-10: æ–‡ä»¶è§£æé›†æˆ
- Day 11-12: é”™è¯¯å¤„ç†å’ŒéªŒè¯
- Day 13-14: æµ‹è¯•å’Œæ–‡æ¡£

---

## 11. å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£
- [Beancount GitHub](https://github.com/beancount/beancount)
- [Beancount è¯­è¨€è¯­æ³•](https://beancount.github.io/docs/beancount_language_syntax.html)
- [Beancount å¿«é€Ÿå‚è€ƒ](https://plaintextaccounting.org/quickref/beancount)
- [Cloudflare Python Workers](https://developers.cloudflare.com/workers/languages/python/how-python-workers-work/)
- [Cloudflare D1 æ•°æ®åº“](https://developers.cloudflare.com/d1/)

### ç¤¾åŒºèµ„æº
- [Awesome Beancount](https://awesome-beancount.com/)
- [Plain Text Accounting](http://plaintextaccounting.org/)
- [Beancount ä¸­æ–‡è®ºå›](https://beancount.io/forum/)

### å·¥å…·å’Œåº“
- [china_bean_importers](https://github.com/jiegec/china_bean_importers) - ä¸­æ–‡ Importer
- [Beanborg](https://github.com/luciano-fiandesio/beanborg) - AI åˆ†ç±»å™¨
- [beancount-categorizer](https://github.com/bratekarate/beancount-categorizer) - è‡ªåŠ¨åˆ†ç±»
- [Fava](https://beancount.github.io/fava/) - Web UI

### æŠ€æœ¯æ–‡ç« 
- [Using LLMs with Beancount](https://beancount.io/docs/Solutions/using-llms-to-automate-and-enhance-bookkeeping-with-beancount)
- [Transaction Reconciliation Best Practices](https://www.highradius.com/resources/Blog/account-reconciliation-software-use-cases/)
- [Fuzzy Matching in Bank Reconciliation](https://optimus.tech/blog/fuzzy-matching-algorithms-in-bank-reconciliation-when-exact-match-fails)
- [95% è‡ªåŠ¨åˆ†ç±»æˆåŠŸæ¡ˆä¾‹](https://beancount.io/forum/t/finally-got-95-automated-expense-categorization-working-with-beancount-llms/93)

---

## é™„å½• A: Beancount ç¤ºä¾‹

### A.1 åŸºç¡€äº¤æ˜“

```
;; å¾®ä¿¡æ”¯ä»˜
2025-01-15 * "ç¾å›¢å¤–å–" "åˆé¤"
    Expenses:Food:Delivery      35.50 CNY
    Assets:WeChat:Cash         -35.50 CNY

;; æ”¯ä»˜å®ä¿¡ç”¨å¡è¿˜æ¬¾
2025-01-20 * "æ”¯ä»˜å®" "ä¿¡ç”¨å¡è¿˜æ¬¾"
    Liabilities:CreditCard:CMB       5000.00 CNY
    Assets:Alipay:Balance           -5000.00 CNY

;; å·¥èµ„æ”¶å…¥
2025-01-25 * "å…¬å¸åç§°" "1æœˆå·¥èµ„"
    Assets:Bank:CSB:Savings        20000.00 CNY
    Income:Salary:Tech            -20000.00 CNY
```

### A.2 ä½™é¢æŒ‡ä»¤

```
;; æœŸåˆä½™é¢
2025-01-01 open Assets:Bank:CSB:Savings
2025-01-01 open Liabilities:CreditCard:CMB
2025-01-01 open Expenses:Food:Groceries

;; è®¾ç½®ä½™é¢
2025-01-01 * "Opening Balance"
    Assets:Bank:CSB:Savings       10000.00 CNY
    Equity:Opening-Balances      -10000.00 CNY
```

### A.3 ä»·æ ¼å’Œæˆæœ¬

```
;; å¤–å¸äº¤æ˜“ï¼ˆå«ä»·æ ¼ï¼‰
2025-01-10 * "Amazon" "è´­ä¹°ä¹¦ç±"
    Expenses:Books:Technical      29.99 USD @ 7.20 CNY
    Assets:CreditCard:Visa       -29.99 USD

;; æŠ•èµ„äº¤æ˜“ï¼ˆå«æˆæœ¬ï¼‰
2025-01-15 * "Brokerage" "ä¹°å…¥è‚¡ç¥¨"
    Assets:Investments:Stocks     100 AAPL {150.00 USD}
    Assets:Bank:Checking         -15000.00 USD
```

---

## é™„å½• B: å¿«é€Ÿå†³ç­–çŸ©é˜µ

| å†³ç­–ç‚¹ | æ¨èé€‰æ‹© | ç†ç”± |
|--------|----------|------|
| **æ¶æ„æ–¹æ¡ˆ** | æ–¹æ¡ˆ Cï¼ˆæ··åˆï¼‰ | å¹³è¡¡æ€§æœ€å¥½ |
| **æ•°æ®æŒä¹…åŒ–** | å¯é€‰ | ç”¨æˆ·é€‰æ‹©ï¼Œçµæ´»æ€§é«˜ |
| **AI æä¾›å•†** | Cloudflare + è‡ªå®šä¹‰ | é»˜è®¤å…è´¹ï¼Œæ”¯æŒé«˜çº§ |
| **é‡å¤æ£€æµ‹** | ç²¾ç¡® + æ¨¡ç³Š | åˆ†å±‚å¤„ç†ï¼Œå‡†ç¡®ç‡é«˜ |
| **Beancount ç”Ÿæˆ** | å­—ç¬¦ä¸²æ‹¼æ¥ | ç®€å•å¤Ÿç”¨ï¼Œåç»­ä¼˜åŒ– |
| **è´¦æˆ·æ˜ å°„** | é¢„è®¾ + å¯ç¼–è¾‘ | å¼€ç®±å³ç”¨ï¼Œçµæ´»å®šåˆ¶ |
| **MVP èŒƒå›´** | æ ¸å¿ƒ 4 åŠŸèƒ½ | å¿«é€ŸéªŒè¯ï¼Œé™ä½é£é™© |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-18  
**è°ƒç ”äººå‘˜**: Claude (Sonnet 4.5)  
**çŠ¶æ€**: å¾…ç”¨æˆ·å®¡æ ¸å’Œå†³ç­–
